// Managed by IAC. Do not edit this file directly.
{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "commitMessageLowerCase": "never", // Ensures sentence case commit messages to comply with commitlint rules
  "extends": [
    "config:recommended",
    "helpers:pinGitHubActionDigests"
  ],
  "minimumReleaseAge": "3 days",
  // the manager module looks for files and extracts their dependencies
  "enabledManagers": [
    "github-actions",
    "terraform",
    "tflint-plugin"
  ],
  // ignore paths must be global to prevent all data sources from being used
  "ignorePaths": [
    "iac/modules/**" // Ignore the IAC modules directory
  ],
  "github-actions": {
    "commitMessagePrefix": "ci(gha): ",
    "ignorePaths": [
      ".trunk/**" // Ignore any updates for the trunk setup-ci action
    ]
  },
  "tflint-plugin": {
    "commitMessagePrefix": "feat(tflint): ",
    "commitMessageTopic": "{{depName}}",
    "fileMatch": [
      // match all .tflint_ci.hcl and .tflint_trunk.hcl files
      // 'ci' and 'trunk' have different configurations
      "\\.tflint_(ci|trunk)\\.hcl$"
    ]
  },
  "packageRules": [
    {
      "matchDatasources": [
        "terraform-provider" // data source for terraform provider
      ],
      // we want to look up dependencies from the OpenTofu registry
      "registryUrls": [
        "https://registry.opentofu.org"
      ],
      // sourceUrl required for release notes. This should be the URL of the provider's GitHub repository
      // Example from renovate docs https://docs.renovatebot.com/templates/#split
      // {{ lookup (split packageName '-') 1 }}
      // packageName: "hashicorp/aws" should be "hashicorp/terraform-provider-aws" for example
      // Not working. See open discussion: https://github.com/renovatebot/renovate/discussions/35153
      //"sourceUrl": "https://github.com/{{ lookup (split packageName '/') 0 }}/terraform-provider-{{ lookup (split packageName '/') 1 }}",
      "addLabels": [
        "tf:update"
      ],
      "commitMessagePrefix": "feat(iac): ",
      "commitMessageTopic": "{{depName}} provider",
      // bump required because v6.6.0, for example, satisfies the range "~> 6.5"
      "rangeStrategy": "bump"
    },
    {
      "matchUpdateTypes": [
        "minor",
        "patch",
        "pin",
        "digest"
      ],
      "matchDepTypes": [
        "action"
      ],
      "automerge": true // Automerge minor and patch updates for GitHub Actions
    },
    {
      // Major updates must be approved on the dependency dashboard
      "matchUpdateTypes": [
        "major"
      ],
      "addLabels": [
        "major"
      ],
      "dependencyDashboardApproval": true
    }
  ],
  "vulnerabilityAlerts": {
    "addLabels": [
      "security"
    ],
    "commitMessagePrefix": "fix(deps): ",
    "rangeStrategy": "auto"
  }
}